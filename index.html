<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Ege Chat</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#0f172a;
  color:white;
  touch-action: manipulation;
}
header{
  padding:12px;
  background:#020617;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
}
#chat{
  height:calc(100vh - 120px);
  overflow-y:auto;
  padding:10px;
}
.msg{
  background:#1e293b;
  margin-bottom:8px;
  padding:8px;
  border-radius:8px;
}
input{
  width:70%;
  padding:10px;
  border-radius:8px;
  border:none;
}
#send{
  width:25%;
}
.hidden{display:none}

/* Admin Panel */
#adminPanel{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:80%;
  background:#020617;
  border-radius:16px 16px 0 0;
  padding:12px;
}
.userRow{
  padding:10px;
  border-bottom:1px solid #334155;
  display:flex;
  justify-content:space-between;
}
.menu{
  background:#020617;
  border:1px solid #334155;
  position:absolute;
  z-index:99;
}
.menu button{
  display:block;
  width:100%;
}
</style>
</head>

<body>

<header>
  <b>ğŸ’¬ Ege Chat</b>
  <button id="adminBtn" class="hidden">âš™ï¸</button>
</header>

<div id="chat"></div>

<div style="display:flex;padding:10px;">
  <input id="msg" placeholder="Mesaj yaz">
  <button id="send">GÃ¶nder</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
  <h3>ğŸ‘‘ Admin Paneli</h3>
  <div id="userList"></div>
  <button onclick="closeAdmin()">Kapat</button>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, set, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCDJ3x--j0YFqOZxz1Wj-o5_QLn9KgJlnk",
  authDomain: "chat-lobby-fa938.firebaseapp.com",
  databaseURL: "https://chat-lobby-fa938-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "chat-lobby-fa938",
  storageBucket: "chat-lobby-fa938.appspot.com",
  messagingSenderId: "436067349066",
  appId: "1:436067349066:web:65f19c754697b6f84d6cb3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const ADMIN_UID = "SENIN_UID_BURAYA"; // giriÅŸ yaptÄ±ktan sonra console'dan yaz
const ADMIN_PASS = "kanarya123";

let uid = null;
let username = localStorage.getItem("username");

if(!username){
  username = prompt("KullanÄ±cÄ± adÄ±n:");
  localStorage.setItem("username",username);
}

signInAnonymously(auth);

onAuthStateChanged(auth,(user)=>{
  if(!user) return;
  uid = user.uid;

  set(ref(db,"users/"+uid),{
    name:username,
    online:true,
    lastSeen:Date.now()
  });

  if(uid===ADMIN_UID){
    document.getElementById("adminBtn").classList.remove("hidden");
  }
});

window.addEventListener("beforeunload",()=>{
  if(uid) update(ref(db,"users/"+uid),{online:false,lastSeen:Date.now()});
});

document.getElementById("send").onclick=()=>{
  const text=msg.value.trim();
  if(!text) return;
  push(ref(db,"messages"),{
    user:username,
    uid,
    text,
    time:Date.now()
  });
  msg.value="";
};

onValue(ref(db,"messages"),snap=>{
  chat.innerHTML="";
  snap.forEach(s=>{
    const m=s.val();
    const div=document.createElement("div");
    div.className="msg";
    div.textContent=m.user+": "+m.text;
    chat.appendChild(div);
  });
  chat.scrollTop=chat.scrollHeight;
});

/* ADMIN */
adminBtn.onclick=()=>{
  const pass=prompt("Admin ÅŸifresi:");
  if(pass!==ADMIN_PASS) return alert("YanlÄ±ÅŸ ÅŸifre");
  adminPanel.classList.remove("hidden");
  loadUsers();
};

function closeAdmin(){
  adminPanel.classList.add("hidden");
}

function loadUsers(){
  onValue(ref(db,"users"),snap=>{
    userList.innerHTML="";
    snap.forEach(s=>{
      const u=s.val();
      const id=s.key;
      const row=document.createElement("div");
      row.className="userRow";
      row.innerHTML=`${u.name} ${u.online?"ğŸŸ¢":"âšª"} <button>â‹®</button>`;
      row.querySelector("button").onclick=(e)=>openMenu(e,id);
      userList.appendChild(row);
    });
  });
}

function openMenu(e,id){
  document.querySelectorAll(".menu").forEach(m=>m.remove());
  const m=document.createElement("div");
  m.className="menu";
  m.style.top=e.clientY+"px";
  m.style.left=e.clientX+"px";
  m.innerHTML=`
    <button onclick="ban('${id}',600000)">10 dk ban</button>
    <button onclick="ban('${id}',3600000)">1 saat ban</button>
    <button onclick="removeUser('${id}')">HesabÄ± sil</button>
  `;
  document.body.appendChild(m);
}

window.ban=(id,time)=>{
  update(ref(db,"users/"+id),{
    bannedUntil:Date.now()+time
  });
  alert("BanlandÄ±");
};

window.removeUser=(id)=>{
  if(confirm("Silinsin mi?")){
    remove(ref(db,"users/"+id));
  }
};
</script>
</body>
</html>